<!DOCTYPE html>
<html lang="it">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Locals</title>
<meta name="description" content="Profili Local per Milano e Roma. Sblocca la mappa inserendo la tua email.">

<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
  integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" crossorigin=""/>

<style>
:root{
  --bg:#f7f7fa;
  --text:#1b1b24;
  --muted:#676a7e;
  --accent:#7c7aac;
  --accent2:#a29fe2;
  --border:#e3e4ef;
  --card:#ffffff;
  --shadow:rgba(124,122,172,0.1);
}

*{box-sizing:border-box}
body{
  margin:0;
  background:var(--bg);
  color:var(--text);
  font:16px/1.6 "Inter", system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, sans-serif;
}

/* Container */
.container{max-width:1100px;margin:auto;padding:32px 24px}

/* Header */
.header{
  display:flex;
  justify-content:space-between;
  align-items:center;
  margin-bottom:32px;
}
.header img{
  height:52px;
  filter:drop-shadow(0 2px 4px var(--shadow));
}
.badge{
  border:1px solid var(--border);
  background:linear-gradient(135deg,var(--accent2)10%,var(--accent)90%);
  color:#fff;
  padding:6px 14px;
  border-radius:999px;
  font-size:13px;
  font-weight:600;
  letter-spacing:.2px;
}

/* Hero */
.hero{
  margin:32px 0;
  text-align:center;
}
.hero h1{
  margin:0 0 10px;
  font-size:34px;
  font-weight:800;
  color:var(--accent);
  background:linear-gradient(90deg,var(--accent),var(--accent2));
  -webkit-background-clip:text;
  -webkit-text-fill-color:transparent;
}
.hero p{
  margin:0 auto;
  color:var(--muted);
  max-width:720px;
  font-size:17px;
}

/* Section titles */
.section-title{
  margin:26px 0 14px;
  font-size:21px;
  font-weight:700;
  color:var(--accent);
}

/* Cards */
.grid{
  display:grid;
  grid-template-columns:repeat(auto-fill,minmax(280px,1fr));
  gap:20px;
}
.card{
  background:var(--card);
  border:1px solid var(--border);
  border-radius:18px;
  overflow:hidden;
  cursor:pointer;
  box-shadow:0 4px 8px var(--shadow);
  transition:transform .15s ease, box-shadow .15s ease;
}
.card:hover{
  transform:translateY(-3px);
  box-shadow:0 10px 22px rgba(124,122,172,0.15);
}
.cover{width:100%;height:220px;object-fit:cover;display:block}
.card-body{padding:14px 16px}
.name{font-weight:700;margin:0 0 4px;font-size:17px}
.subtitle{color:var(--muted);font-size:13.5px;margin:0 0 10px}
.chips{display:flex;flex-wrap:wrap;gap:6px}
.pill{background:#f0efff;border:1px solid #e3e1ff;color:#3c3a6a;padding:5px 9px;border-radius:999px;font-size:11.5px}

/* modal */
.modal-backdrop{
  position:fixed;
  inset:0;
  background:rgba(0,0,0,.55);
  display:none;
  place-items:center;
  z-index:100;
}
.modal{
  width:min(760px,96%);
  background:#fff;
  border-radius:16px;
  overflow:hidden;
  display:flex;
  flex-direction:column;
  max-height:90vh;
}
.modal-head{
  padding:12px 16px;
  border-bottom:1px solid var(--border);
  display:flex;
  justify-content:space-between;
  align-items:center;
  background:#f4f3ff;
}
.modal-title{font-weight:800}
.modal-sub{font-size:12.5px;color:#6a6f82}
.close{cursor:pointer;font-size:18px;border:none;background:none;color:#666;line-height:1}
.close:hover{color:var(--accent)}
.modal-body{padding:14px 16px;overflow:auto}
.modal img{width:100%;height:220px;border-radius:12px;object-fit:cover}
.about{margin:10px 0 10px}
.keywords{display:flex;flex-wrap:wrap;gap:8px;margin:6px 0 10px}
.keyword{padding:6px 10px;border-radius:999px;border:1px solid var(--border);background:#fafaff;font-size:12.5px;cursor:pointer}
.keyword.active{background:var(--accent);color:#fff;border-color:var(--accent)}
.form{display:grid;grid-template-columns:1fr auto;gap:8px;align-items:center;margin:8px 0 0}
input[type=email]{padding:9px 10px;border:1px solid var(--border);border-radius:10px;font-size:14.5px;width:100%}
.btn{padding:10px 12px;border-radius:10px;font-weight:700;cursor:pointer}
.btn-primary{background:linear-gradient(90deg,var(--accent),var(--accent2));border:none;color:#fff}
.map-wrap{margin-top:12px}
#map{height:360px;border-radius:12px;border:1px solid var(--border)}
.footer{margin-top:24px;color:#8a93a8;font-size:12.5px;text-align:center}
.hidden{display:none!important}

/* ---------- Responsive adjustments ---------- */
@media (max-width: 768px){
  .container{padding:20px 16px}
  .header img{height:42px}
  .badge{padding:4px 10px;font-size:12px}
  .hero h1{font-size:26px}
  .hero p{font-size:15px;max-width:90%}
  .section-title{font-size:18px;margin:18px 0 10px}
  .card{border-radius:14px}
  .card-body{padding:10px 12px}
  .name{font-size:15.5px}
  .subtitle{font-size:12.5px}
  .pill{font-size:11px;padding:4px 8px}
  .modal{width:94%;max-height:88vh;border-radius:14px}
  .modal img{height:180px}
  .form{grid-template-columns:1fr;gap:6px}
  .btn-primary{width:100%}
  #map{height:280px}
}
@media (max-width: 480px){
  .hero h1{font-size:22px}
  .hero p{font-size:14.5px}
  .badge{display:none}
}
</style>
</head>
<body>
  <div class="container">
    <header class="header">
      <div style="display:flex;align-items:center;gap:10px">
        <img src="logo.png" alt="Locals">
      </div>
      <div class="badge">MVP di validazione</div>
    </header>
    <section class="hero">
      <h1>Mappe umane per viaggiare meglio</h1>
      <p>Leggi il profilo del Local e sblocca la mappa personalizzata inserendo la tua email.</p>
    </section>

    <section id="cards"></section>
    <footer class="footer">© Locals – prototipo di validazione.</footer>
  </div>

  <!-- Modal -->
  <div id="modal" class="modal-backdrop" role="dialog" aria-modal="true">
    <div class="modal">
      <div class="modal-head">
        <div>
          <div id="modalTitle" class="modal-title"></div>
          <div id="modalSubtitle" class="modal-sub"></div>
        </div>
        <button id="modalClose" class="close" aria-label="Chiudi">✕</button>
      </div>
      <div class="modal-body">
        <img id="modalCover" src="" alt="" loading="lazy">
        <p id="modalAbout" class="about"></p>
        <div id="keywords" class="keywords"></div>

        <form id="unlockForm" class="form">
          <input id="email" type="email" placeholder="Email per sbloccare la mappa" required>
          <button type="submit" id="btnUnlock" class="btn btn-primary">Sblocca mappa</button>
        </form>

        <div id="mapWrap" class="map-wrap hidden">
          <div id="map"></div>
        </div>
      </div>
    </div>
  </div>

<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
  integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" crossorigin=""></script>
<script>
/* ---------- CONFIG ---------- */
const SUBMIT_ENDPOINT = ""; // opzionale

const imgPath = (name) => `covers/${name}`;

const MAPS = [
  // Milano – più POI con popup
  { id:"mi-giulia", city:"Milano", title:"Giulia – Foodie & Design",
    cover: imgPath("mi-giulia.webp"),
    subtitle:"Product designer e pasticcerie d’autore",
    about:"Pasticcerie, bookshop, cortili nascosti e caffè curati. Milano da vivere con gusto.",
    keywords:["Foodie","Design","Caffè","Brunch","Arte"],
    center:[45.463,9.189],
    poi:[
      {name:"Trippa",type:"Ristorante",coords:[45.4508,9.2054]},
      {name:"Bar Luce",type:"Caffè",coords:[45.4516,9.1796]},
      {name:"Pavé",type:"Bakery",coords:[45.4773,9.2058]},
      {name:"10 Corso Como",type:"Concept",coords:[45.4848,9.1849]},
      {name:"Isola Murales",type:"Passeggiata",coords:[45.4897,9.1911]},
      {name:"Eutopia",type:"Wine Bar",coords:[45.4706,9.2069]},
      {name:"Upcycle",type:"Café",coords:[45.4890,9.2276]},
      {name:"Nonostante Marras",type:"Spazio",coords:[45.4746,9.1609]},
      {name:"Drogheria Milanese",type:"Bistrot",coords:[45.4648,9.1771]},
      {name:"MAG Café",type:"Cocktail",coords:[45.4513,9.1838]},
      {name:"Pasticceria Grecchi Luigi",type:"Pasticceria",coords:[45.482353,9.166655]},
      {name:"Antica Trattoria Ambrosiana",type:"Trattoria",coords:[45.517264,9.19165]},
      {name:"Latteria Carlon",type:"Latteria",coords:[45.471912,9.203508]},
      {name:"La Belle Aurore",type:"Caffè Letterario",coords:[45.471893,9.214477]},
      {name:"Trattoria Sabbioneda",type:"Trattoria",coords:[45.480135,9.2088]},
      {name:"Gelateria Umberto",type:"Gelateria",coords:[45.461894,9.206555]}
    ]
  },
  { id:"mi-luca", city:"Milano", title:"Luca – Tech & Alternative Night",
    cover: imgPath("mi-luca.webp"),
    subtitle:"Dev by day, clubber by night",
    about:"Coworking e club nascosti tra Navigli e Isola. Milano alternativa e notturna.",
    keywords:["Nightlife","Startups","Musica","Cocktail"],
    center:[45.463,9.189],
    poi:[
      {name:"BASE",type:"Hub",coords:[45.4517,9.1702]},
      {name:"Tempio del Futuro Perduto",type:"Spazio",coords:[45.4899,9.1802]},
      {name:"Tunnel Club",type:"Club",coords:[45.4868,9.2018]},
      {name:"FAQ",type:"Club",coords:[45.4653,9.1910]},
      {name:"Le Biciclette",type:"Bar",coords:[45.4616,9.1865]},
      {name:"Spirit de Milan",type:"Club",coords:[45.5185,9.1408]},
      {name:"NoLo",type:"Quartiere",coords:[45.4970,9.2185]},
    
      // nuovi da posti_sinceri_poi_snippet.js
      {name:"Bar Nievo",type:"Bar Storico",coords:[45.493969,9.144644]},
      {name:"Zodiaco Bar",type:"Bar",coords:[45.479552,9.183431]},
      {name:"Bar Tabacchi Gallo - Tavola Fredda",type:"Bar di quartiere",coords:[45.500369,9.178446]},
      {name:"Trattoria da Tomaso",type:"Trattoria popolare",coords:[45.485598,9.191453]},
      {name:"Margy Burger",type:"Street food",coords:[45.462339,9.194208]},
      {name:"Bocciofila Martesana Dance",type:"Bocciofila/Spazio sociale",coords:[45.502941,9.219486]},
      {name:"Bar Paperoga",type:"Bar alternativo",coords:[45.464807,9.23002]}
    ]
  },

  // Roma
  { id:"rm-sara", city:"Roma", title:"Sara – Classici & Nascosti",
    cover: imgPath("rm-sara.webp"),
    subtitle:"Archivista e cortili segreti",
    about:"Belvederi, logge e giardini romani: una Roma lenta e fotografica.",
    keywords:["Storia","Fotografia","Giardini","Relax"],
    center:[41.9028,12.4964],
    poi:[
      {name:"Gianicolo",type:"Panorama",coords:[41.8925,12.4612]},
      {name:"Coppedè",type:"Quartiere",coords:[41.9197,12.5116]},
      {name:"Orto Botanico",type:"Giardino",coords:[41.8938,12.4660]},
      {name:"Mercato Testaccio",type:"Mercato",coords:[41.8778,12.4763]},
      {name:"Via Margutta",type:"Strada",coords:[41.9074,12.4798]},
      {name:"Villa Torlonia",type:"Parco",coords:[41.9142,12.5112]},
      {name:"Sant'Eustachio",type:"Caffè",coords:[41.8996,12.4761]},
      {name:"Fori Imperiali (alba)",type:"Passeggiata",coords:[41.8923,12.4853]},
      {name:"Giardino degli Aranci",type:"Panorama",coords:[41.8817,12.4792]},
    ]
  },
  { id:"rm-davide", city:"Roma", title:"Davide – Street Food & Nightlife",
    cover: imgPath("rm-davide.webp"),
    subtitle:"Food trucker e nottambulo",
    about:"Supplì croccanti, piazze vive e birre artigianali. Roma da assaporare fino a tardi.",
    keywords:["Street food","Nightlife","Birre","Aperitivi"],
    center:[41.9028,12.4964],
    poi:[
      {name:"Trapizzino Testaccio",type:"Street food",coords:[41.8769,12.4769]},
      {name:"Open Baladin",type:"Birreria",coords:[41.8984,12.4737]},
      {name:"Drink Kong",type:"Cocktail",coords:[41.9000,12.4797]},
      {name:"Pigneto",type:"Quartiere",coords:[41.8895,12.5361]},
      {name:"Dar Poeta",type:"Pizzeria",coords:[41.8908,12.4687]},
      {name:"San Lorenzo",type:"Zona",coords:[41.9009,12.5203]},
      {name:"Tiberis",type:"Area estiva",coords:[41.9251,12.4677]},
    ]
  }
];

/* ---------- RENDER LISTE ---------- */
const cardsEl = document.getElementById('cards');
function cardHtml(m){
  return `
  <article class="card" onclick="openModal('${m.id}')">
    <img class="cover" src="${m.cover}" alt="${m.title}" loading="lazy">
    <div class="card-body">
      <h3 class="name">${m.title}</h3>
      <p class="subtitle">${m.subtitle}</p>
      <div class="chips">${m.keywords.map(k=>`<span class="pill">${k}</span>`).join('')}</div>
    </div>
  </article>`;
}
function renderCards(){
  const mi = MAPS.filter(x=>x.city==="Milano");
  const rm = MAPS.filter(x=>x.city==="Roma");
  cardsEl.innerHTML = `
    <h2 class="section-title">Milano</h2>
    <div class="grid">${mi.map(cardHtml).join('')}</div>
    <h2 class="section-title">Roma</h2>
    <div class="grid">${rm.map(cardHtml).join('')}</div>`;
}
renderCards();

/* ---------- MODAL + MAP ---------- */
const modal = document.getElementById('modal');
const modalTitle = document.getElementById('modalTitle');
const modalSubtitle = document.getElementById('modalSubtitle');
const modalCover = document.getElementById('modalCover');
const modalAbout = document.getElementById('modalAbout');
const keywordsBox = document.getElementById('keywords');
const unlockForm = document.getElementById('unlockForm');
const emailInput = document.getElementById('email');
const mapWrap = document.getElementById('mapWrap');
const mapDiv = document.getElementById('map');

let current=null, mapInstance=null, markers=[];

function openModal(id){
  current = MAPS.find(x=>x.id===id);
  modalTitle.textContent = current.title;
  modalSubtitle.textContent = current.subtitle;
  modalCover.src = current.cover;
  modalAbout.textContent = current.about;
  // keywords
  keywordsBox.innerHTML = "";
  current.keywords.forEach(k=>{
    const el=document.createElement('div'); el.className='keyword'; el.textContent=k;
    el.onclick=()=>el.classList.toggle('active');
    keywordsBox.appendChild(el);
  });
  // nascondi mappa finché non sblocco
  mapWrap.classList.add('hidden');
  unlockForm.reset();
  modal.style.display='grid';
}

function closeModal(){ modal.style.display='none'; }
document.getElementById('modalClose').addEventListener('click',closeModal);

unlockForm.addEventListener('submit', async (e)=>{
  e.preventDefault();
  const email = emailInput.value.trim();
  if(!email){ alert("Inserisci un'email valida"); return; }

  // opzionale: invio a endpoint
  if(SUBMIT_ENDPOINT){
    try{
      await fetch(SUBMIT_ENDPOINT,{
        method:'POST',headers:{'Content-Type':'application/json'},
        body: JSON.stringify({ email, mapId: current.id, city: current.city, ts: Date.now(),
          interests: Array.from(document.querySelectorAll('.keyword.active')).map(x=>x.textContent) })
      });
    }catch(_){}
  }

  showMap();
});

function showMap(){
  mapWrap.classList.remove('hidden');

  if(!mapInstance){
    mapInstance = L.map('map');
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png',{maxZoom:19}).addTo(mapInstance);
  }
  // Leaflet fix: ricalcola dimensioni dopo il reveal
  setTimeout(()=> mapInstance.invalidateSize(), 0);

  markers.forEach(m=>m.remove());
  markers=[];
  mapInstance.setView(current.center,13);

  current.poi.forEach(p=>{
    const mk=L.marker(p.coords).addTo(mapInstance)
      .bindPopup(`
        <b>${p.name}</b><br>
        <small>${p.type||""}</small><br>
        <a href="https://www.google.com/maps?q=${encodeURIComponent(p.name)}%20${encodeURIComponent(current.city)}" target="_blank" rel="noopener noreferrer">>
          🌐 Apri su Google Maps
        </a>
      `);
    markers.push(mk);
  });
}
</script>
</body>
</html>
